
```java
public Response downNewBillList(@Context HttpServletRequest request, @Context HttpServletResponse response, @QueryParam("operator") String operator, @QueryParam("projectName") String projectName,  
                        @QueryParam("buildingNo") String buildingNo, @QueryParam("isCharter") String isCharter, @QueryParam("houseNo") String houseNo, @QueryParam("payStart") String payStart,  
                        @QueryParam("overDueStatus") String overDueStatus, @QueryParam("billName") String billName, @QueryParam("billType") String billType, @QueryParam("payEnd") String payEnd,  
                        @QueryParam("tenantName") String tenantName, @QueryParam("voucherNo") String voucherNo, @QueryParam("payer") String payer, @QueryParam("billStartTime") String billStartTime,  
                        @QueryParam("billEndTime") String billEndTime, @QueryParam("type") String type, @QueryParam("onSigning") String onSigning, @QueryParam("billStatus") String billStatus, @QueryParam("master") String master,  
                        @QueryParam("pending") String pending, @QueryParam("signStartDate") String signStartDate, @QueryParam("contractStartDate") String contractStartDate, @QueryParam("contractEndDate") String contractEndDate, @QueryParam("signEndDate") String signEndDate, @QueryParam("community") String community, @QueryParam("jiaofeiType") String jiaofeiType)  
      throws ParseException {  
   LOG.info("billList operator :{} projectName :{} buildingNo :{} houseNo :{} overDueStatus :{} billName :{} billType :{} tenantName :{} payer :{} billStartTime :{} billEndTime :{} type :{} onSigning :{} billStatus :{} community :{}", operator, projectName, buildingNo, houseNo, overDueStatus, billName, billType, tenantName, payer, billStartTime, billEndTime, type, onSigning, billStatus, community);  
   String[] operators = null;  
   if (StringUtils.isNotBlank(operator)) {  
      operators = operator.split(",");  
   }  
   String[] projectNames = null;  
   if (StringUtils.isNotBlank(projectName)) {  
      projectNames = projectName.split(",");  
   }  
   String[] communitys = null;  
   if (StringUtils.isNotBlank(community)) {  
      communitys = community.split(",");  
   }  
   String[] jiaofeiTypes = null;  
   if (StringUtils.isNotBlank(jiaofeiType)) {  
      jiaofeiTypes = jiaofeiType.split(",");  
   }  
   if (!StringUtils.isEmpty(overDueStatus) && !"0".equals(overDueStatus)) {  
      if (!"0".equals(billStatus)) {  
         throw ApplicationException.custom_action(-1002, "billstatus参数值需设置为0");  
      }  
   }  
   String bls = "";  
   String ble = "";  
   String cashier = "";  
   if (StringUtils.isNotBlank(pending) && "1".equals(pending)) {  
      bls = DateUtil.getLastDayOfMonth(new Date());  
      billStatus = "0";  
   }  
   if ("3".equals(billStatus)) {  
      cashier = "1";  
      billStatus = "0";  
   }  
   List<Object[]> bills = billDataSQL(operators, projectNames, buildingNo, houseNo, billName, tenantName, payer,  
         billStartTime, billEndTime, billStatus, bls, ble, onSigning, billType, overDueStatus, type, isCharter, voucherNo, payStart, payEnd, cashier, signStartDate, contractStartDate, contractEndDate, signEndDate, master, communitys, jiaofeiTypes, 0, 0);  
   List<Map<String, Object>> listJson = getBillListReturnMaps(type, bills);  
   String[] title = {"房源", "项目名称", "是否包租", "承租方", "承租人", "付款人", "付款人联系方式",  
         "账单周期", "账单类型", "付款方式", "合同属性", "账单金额", "待收金额", "免租金额",  
         "应收日期", "实收日期", "账单状态", "短信是否成功", "签约日期", "合同周期", "备注", "凭证号码", "逾期天数", "失败原因"};  
   List<String[]> contentList = new ArrayList<>();  
   listJson.forEach(obj -> {  
      String[] content = {  
            String.valueOf(obj.get("houseNo")),  
            String.valueOf(obj.get("projectName")),  
            "04".equals(String.valueOf(obj.get("contractAttribute"))) ? "是" : "否",  
            String.valueOf(obj.get("master")),  
            String.valueOf(obj.get("tenantName")),  
            String.valueOf(obj.get("payer")),  
            String.valueOf(obj.get("payerTel")),  
            String.valueOf(obj.get("billStartTime")) + " - " + String.valueOf(obj.get("billEndTime")),  
            String.valueOf(obj.get("name")),  
            String.valueOf(obj.get("jiaofeiType")),  
            StatusUtil.getContractAttributeString(String.valueOf(obj.get("contractAttribute"))),  
            String.valueOf(obj.get("billAmount")),  
            String.valueOf(obj.get("unBillPaidAmount")),  
            String.valueOf(obj.get("subsidyMoney")),// 免租金额  
            String.valueOf(obj.get("collectionPeriod")),// 收账日期  
            String.valueOf(obj.get("payTime")),// 实收日期  
            "0".equals(String.valueOf(obj.get("billStatus"))) ? "未支付" : "已支付",  
            String.valueOf(obj.get("smsAdv")),// 短信  
            DateUtil.fomatDate3(String.valueOf(obj.get("signDate"))),// 签约日期  
            DateUtil.fomatDate3(String.valueOf(obj.get("contractStartDate"))) + " - " + DateUtil.fomatDate3(String.valueOf(obj.get("contractEndDate"))),  
            String.valueOf(obj.get("remark")),// 备注  
            String.valueOf(obj.get("voucherNo")),// 凭证号  
            String.valueOf(obj.get("overDueDay")),  
            String.valueOf(obj.get("smsCause")) // 失败原因  
      };  
      contentList.add(content);  
   });  
   response = ExcelUtil.downLoadExcel(response, ExcelUtil.exportExcel("账单列表页", title, contentList.toArray(new String[0][0])), "downNewBillList");  
   return Response.ok(RestResult.ok()).header("Access-Control-Allow-Origin", "*").build();  
}

```


```java
private List<Map<String, Object>> getBillListReturnMaps(String type, List<Object[]> bills) {  
   List<Map<String, Object>> listJson = new ArrayList<Map<String, Object>>();  
   for (int i = 0; i < bills.size(); i++) {  
      List<Object[]> li = new ArrayList<Object[]>();  
      li.add(bills.get(i));  
      for (Object[] o : li) {  
         Map<String, Object> map = new HashMap<String, Object>();  
         map.put("id", i);  
         map.put("projectName", o[0]);  
         map.put("houseNo", o[1]);  
         long houseCount = 0;  
         if (o[11] != null && "04".equals(o[11].toString())) {  
            if (o[19] != null) {  
               String[] split = o[19].toString().split(",");  
               houseCount = split.length;  
            }  
         }  
         map.put("houseCount", houseCount);  
         map.put("payer", o[27] == null ? (o[2] == null ? "" : o[2]) : o[27]);  
         map.put("payerTel", o[3] == null ? (o[28] == null ? "" : o[28]) : o[3]);  
         map.put("collectionPeriod", o[4]);  
         map.put("billStartTime", o[5]);  
         map.put("billEndTime", o[6]);  
         map.put("name", o[7]);  
         map.put("tenantName", o[8]);  
         map.put("jiaofeiType", o[9] == null ? "" : o[9]);  
         map.put("contractAttribute", o[11]);  
         map.put("billAmount", o[12]);  
         map.put("billPaidAmount", o[13] == null ? "" : o[13]);  
         map.put("unBillPaidAmount", calculateObject(o[12], o[13]));  
         map.put("billStatus", o[14]);  
         map.put("payTime", o[18] == null ? "" : o[18]);  
         int overDueDay = 0;  
         if ("0".equals(o[14].toString())) {  
            overDueDay = DateUtil.differentDays(o[5].toString(), DateUtil.getTime1(new Date()));  
         }  
         map.put("overDueDay", overDueDay);  
         map.put("totalContractNo", o[17] == null ? "" : o[17]);  
         map.put("houseId", o[19]);  
         map.put("costType", o[20]);  
         if (StringUtils.isNotBlank(type) && "1".equals(type) && "04".equals(o[11].toString())) {  
            map.put("totalFlag", "1");  
         } else {  
            map.put("totalFlag", o[21]);  
         }  
         map.put("billNo", o[15]);  
         map.put("contractNo", o[16]);  
         map.put("voucherNo", o[25] == null ? "" : o[25]);  
         map.put("voucherUrl", o[26] == null ? "" : o[26]);  
         map.put("smsAdv", o[29] == null ? "" : o[29]);  
         map.put("smsCause", o[30] == null ? "" : o[30]);  
         map.put("cashier", o[31] == null ? "0" : o[31]);  
         map.put("batchNo", o[32] == null ? "0" : o[32]);  
         map.put("contractStartDate", o[33] == null ? "" : o[33]);  
         map.put("contractEndDate", o[34] == null ? "" : o[34]);  
         map.put("location", o[35] == null ? "" : o[35]);  
         map.put("remark", o[36] == null ? "" : o[36]);  
         map.put("signDate", o[37] == null ? "" : o[37]);  
         map.put("master", o[38] == null ? "" : o[38]);  
         map.put("approverFlag", o[39] == null ? "0" : o[39]);  
         map.put("rentCenter", o[40] == null ? "" : o[40]);  
         map.put("subsidyMoney", o[41] == null ? "0" : o[41]);  
         map.put("community", o[42] == null ? "0" : o[42]);  
         listJson.add(map);  
      }  
   }  
   return listJson;  
}

```