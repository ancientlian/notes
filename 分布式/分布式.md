
# 概述

分布式业务系统，就是把原来用 Java 开发的一个大块系统，给拆分成**多个子系统**，多个子系统之间互相调用，形成一个大系统的整体。

## CAP & BASE理论

## CAP 理论

在理论计算机科学中，CAP 定理（CAP theorem）指出对于一个分布式系统来说，当设计读写操作时，只能同时满足以下三点中的两个：

-   **一致性（Consistency）** : 所有节点访问同一份最新的数据副本
-   **可用性（Availability）**: 非故障的节点在合理的时间内返回合理的响应（不是错误或者超时的响应）；每次请求都能获取到非错的响应——但是不保证获取的数据为最新数据
-   **分区容错性（Partition Tolerance）** : 分布式系统出现网络分区的时候，仍然能够对外提供服务；系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在 C 和 A 之间做出选择。

分布式系统理论上不可能选择 CA 架构，只能选择 CP 或者 AP 架构。

## 常用的 CAP 框架

| 框架      | 所属   | 注解                                                                                                                                                                                                                                                                                                                                          |     |
| --------- | ------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --- |
| Eureka    | AP     | Eureka 在设计的时候就是优先保证 A （可用性）。在 Eureka 中不存在什么 Leader 节点，每个节点都是一样的、平等的。因此 Eureka 不会像 ZooKeeper 那样出现选举过程中或者半数以上的机器不可用的时候服务就是不可用的情况。 Eureka 保证即使大部分节点挂掉也不会影响正常提供服务，只要有一个节点是可用的就行了。只不过这个节点上的数据可能并不是最新的。 |     |
| Cassandra | AP     |                                                                                                                                                                                                                                                                                                                                               |     |
| Zookeeper | CP     | 任何时刻对 ZooKeeper 的读请求都能得到一致性的结果，但是， ZooKeeper 不保证每次请求的可用性比如在 Leader 选举过程中或者半数以上的机器不可用的时候服务就是不可用的。                                                                                                                                                                            |     |
| Consul    | CP     |                                                                                                                                                                                                                                                                                                                                               |     |
| HBase     | CP     |                                                                                                                                                                                                                                                                                                                                               |     |
| Nacos     | AP、CP | Nacos默认采用AP模式。在1.0版本之后采用AP+CP模式混合实现注册中心。                                                                                                                                                                                                                                                                             |     |
|           |        |                                                                                                                                                                                                                                                                                                                                               |     |

## BASE 理论

BASE 是 **Basically Available（基本可用） 、Soft-state（软状态） 和 Eventually Consistent（最终一致性）** 三个短语的缩写。
BASE 理论是对 CAP 中一致性 C 和可用性 A 权衡的结果，其来源于对大规模互联网系统分布式实践的总结，是基于 CAP 定理逐步演化而来的，它大大降低了我们对系统的要求。


## 分布式事务

分布式事务的实现主要有以下 6 种方案：

-   XA 方案
-   TCC 方案
-   SAGA 方案
-   本地消息表
-   可靠消息最终一致性方案
-   最大努力通知方案

### Seata


## RPC

RPC(Remote Procedure Call)远程过程调用，简单的理解是一个节点请求另一个节点提供的服务。

一言蔽之：**RPC 的出现就是为了让你调用远程方法像调用本地方法一样简单。**

它的工作流程是这样的：

1.  执行客户端调用语句，传送参数
2.  调用本地系统发送网络消息
3.  消息传送到远程主机
4.  服务器得到消息并取得参数
5.  根据调用请求以及参数执行远程过程（服务）
6.  执行过程完毕，将结果返回服务器句柄
7.  服务器句柄返回结果，调用远程主机的系统网络服务发送结果
8.  消息传回本地主机
9.  客户端句柄由本地主机的网络服务接收消息
10.  客户端接收到调用语句返回的结果数据

## HTTP 与 RPC


## 分布式锁

[分布式锁中的王者方案 - Redisson](https://mp.weixin.qq.com/s/CbnPRfvq4m1sqo2uKI6qQw)
