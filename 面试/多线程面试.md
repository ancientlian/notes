# start 与 run 区别

1. start（）方法来启动线程，真正实现了多线程运行。这时无需等待 run 方法体代码执行完毕，可
以直接继续执行下面的代码。
2. 通过调用 Thread 类的 start()方法来启动一个线程， 这时此线程是处于就绪状态， 并没有运行。
3. 方法 run()称为线程体，它包含了要执行的这个线程的内容，线程就进入了运行状态，开始运行
run 函数当中的代码。 Run 方法运行结束， 此线程终止。然后 CPU 再调度其它线程。

# 后台线程 守护线程

1. 定义：守护线程--也称“服务线程”，他是后台线程，它有一个特性，即为用户线程提供公共服务，
在没有用户线程可服务时会自动离开。
2. 优先级：守护线程的优先级**比较低**，用于为系统中的其它对象和线程提供服务。
3. 设置：通过 `setDaemon(true)`来设置线程为“守护线程”；将一个用户线程设置为守护线程的方式是
在 线程对象创建 之前 用线程对象的 `setDaemon` 方法。
4. 在 Daemon 线程中产生的新线程也是 Daemon 的。
5. 线程则是 JVM 级别的，以 Tomcat 为例，如果你在 Web 应用中启动一个线程，这个线程的生命周
期并不会和 Web 应用程序保持同步。也就是说，即使你停止了 Web 应用，这个线程依旧是活跃的。
6. example: **垃圾回收线程**就是一个经典的守护线程，当我们的程序中不再有任何运行的Thread, 程
序就不会再产生垃圾，垃圾回收器也就无事可做，所以当垃圾回收线程是 JVM 上仅剩的线程时，垃
圾回收线程会自动离开。它始终在低级别的状态中运行，用于实时监控和管理系统中的可回收资
源。
7. 生命周期：守护进程（Daemon）是运行在后台的一种特殊进程。它独立于控制终端并且周期性地
执行某种任务或等待处理某些发生的事件。也就是说守护线程不依赖于终端，但是**依赖于系统****，与**
**系统“同生共死”**。当 JVM 中所有的线程都是守护线程的时候，JVM 就可以退出了；如果还有一个或
以上的非守护线程则 JVM 不会退出。



# 乐观锁

乐观锁是一种乐观思想，即**认为读多写少**，遇到并发写的可能性低，每次去拿数据的时候都认为别人不
会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，采取在写
时先读出当前版本号，然后加锁操作（比较跟上一次的版本号，如果一样则更新），如果失败则要重复
读-比较-写的操作。
java 中的乐观锁基本都是通过 **CAS 操作**实现的，CAS 是一种更新的原子操作，比较当前值跟传入值是否
一样，一样则更新，否则失败。



# 悲观锁

悲观锁是就是悲观思想，即认为写多，遇到并发写的可能性高，每次去拿数据的时候都认为别人会修
改，所以每次在读写数据的时候都会上锁，这样别人想读写这个数据就会block直到拿到锁。 java中的悲
观锁就是`Synchronized`,AQS框架下的锁则是先尝试cas乐观锁去获取锁，获取不到，才会转换为悲观
锁，如 `RetreenLock`。



# 自旋锁

自旋锁原理非常简单，如果持有锁的线程能在很短时间内释放锁资源，那么那些等待竞争锁的线程就不
需要做内核态和用户态之间的切换进入阻塞挂起状态，它们只需要等一等（自旋），等持有锁的线程释
放锁后即可立即获取锁，这样就避免用户线程和内核的切换的消耗。

线程自旋是需要消耗 cup 的，说白了就是让 cup 在做无用功，如果一直获取不到锁，那线程也不能一直
占用 cup 自旋做无用功，所以**需要设定一个自旋等待的最大时间**。

如果持有锁的线程执行的时间超过自旋等待的最大时间扔没有释放锁，就会导致其它争用锁的线程在最
大等待时间内还是获取不到锁，这时争用线程会停止自旋进入阻塞状态。
自旋锁的优缺点
自旋锁尽可能的减少线程的阻塞，这对于锁的竞争不激烈，且占用锁时间非常短的代码块来说性能能大
幅度的提升，因为自旋的消耗会小于线程阻塞挂起再唤醒的操作的消耗，这些操作会导致线程发生两次
上下文切换！
但是如果锁的竞争激烈，或者持有锁的线程需要长时间占用锁执行同步块，这时候就不适合使用自旋锁
了，因为自旋锁在获取锁前一直都是占用 cpu 做无用功，占着 XX 不 XX，同时有大量线程在竞争一个
锁，会导致获取锁的时间很长，线程自旋的消耗大于线程阻塞挂起操作的消耗，其它需要 cup 的线程又
不能获取到 cpu，造成 cpu 的浪费。所以这种情况下我们要关闭自旋锁；
自旋锁时间阈值（1.6引入了适应性自旋锁）
自旋锁的目的是为了占着 CPU 的资源不释放，等到获取到锁立即进行处理。但是如何去选择自旋的执行
时间呢？如果自旋执行时间太长，会有大量的线程处于自旋状态占用 CPU 资源，进而会影响整体系统的
性能。因此自旋的周期选的额外重要！